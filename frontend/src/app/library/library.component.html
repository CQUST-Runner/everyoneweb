<app-full-screen-spinner [isShow]="isLoading"></app-full-screen-spinner>
<div fxLayout="row" fxLayoutGap="10px" style="overflow: hidden; height: 100%;">
  <div fxFlex="15%" fxLayout="column" style="overflow: hidden;">

    <div style="overflow-y: auto;">
      <mat-selection-list #list22 *ngIf="toggle.checked" #shoes multiple="true"
        (after-if)="selectCategory('after-if');">
        <mat-list-option #select_all (click)="select(select_all, list22);" value="_all">
          <mat-icon mat-list-icon>select_all</mat-icon>
          <div mat-line>不限类别</div>
        </mat-list-option>
        <mat-list-option #self (click)="unselectSelectAll(self,select_all);" *ngFor="let category of categories"
          [value]="category">
          <mat-icon mat-list-icon>folder</mat-icon>
          <div mat-line>{{category}}</div>
        </mat-list-option>
      </mat-selection-list>
      <mat-selection-list #list22 (selectionChange)="selectCategory('change');" *ngIf="!toggle.checked"
        (after-if)="selectCategory('after-if');" #shoes multiple="false">
        <mat-list-option value="_all" selected>
          <mat-icon mat-list-icon>select_all</mat-icon>
          <div mat-line>不限类别</div>
        </mat-list-option>
        <mat-list-option [disabled]="!showCreateCategory" cdkDropList dropToHereToSetCategory id="_newCategory"
          (cdkDropListDropped)="createNewCategoryAndSet($event);">
          <mat-icon mat-list-icon>add</mat-icon>
          <div mat-line>新建</div>
        </mat-list-option>
        <mat-list-option cdkDropList dropToHereToSetCategory [id]="category"
          (cdkDropListDropped)="onDroped($event,category)" *ngFor="let category of categories" [value]="category">
          <mat-icon mat-list-icon>folder</mat-icon>
          <div mat-line>{{category}}</div>
        </mat-list-option>
      </mat-selection-list>
      <p>
        <!-- Options selected: {{shoes.selectedOptions.selected.length}} -->
      </p>
    </div>

    <div fxFlex="1 0 auto"></div>
    <mat-divider></mat-divider>

    <div style="padding: 10px 20px;" fxFlexAlign="start">
      <mat-slide-toggle #toggle color="accent">
        多选
      </mat-slide-toggle>
    </div>
  </div>
  <div fxFlex="1 1 auto" fxLayout="column" fxLayoutGap="10px" style="overflow:hidden; padding:5px 20px;">
    <!-- 
    Table retrieving data through HTTP
    -->
    <mat-expansion-panel fxFlex="0 0 auto">
      <mat-expansion-panel-header>
        <mat-form-field appearance="standard">
          <mat-label>搜索</mat-label>
          <input [formControl]="searchFormControl" matInput (keyup)="applyFilter($event)" placeholder="Ex. Mia" #input>
          <mat-icon matSuffix>search</mat-icon>
        </mat-form-field>
      </mat-expansion-panel-header>

      <div fxLayout="column">
        <div>
          <span>rating:</span>
          <mat-button-toggle-group [formControl]="ratingFormControl" multiple>
            <mat-button-toggle value="1">1</mat-button-toggle>
            <mat-button-toggle value="2">2</mat-button-toggle>
            <mat-button-toggle value="3">3</mat-button-toggle>
            <mat-button-toggle value="4">4</mat-button-toggle>
            <mat-button-toggle value="5">5</mat-button-toggle>
          </mat-button-toggle-group>
        </div>

        <div fxLayout="row" fxLayoutGap="10px" fxLayoutAlign="start center">
          <app-tags-input fxFlex="0 0 50%" [control]="tagsFormControl" [availableTags]="tags"></app-tags-input>

          <mat-slide-toggle [formControl]="matchAllFormControl" color="accent">
            同时满足
          </mat-slide-toggle>
        </div>
      </div>
    </mat-expansion-panel>

    <div fxFlex="1 1 auto" style="overflow-y:auto;">

      <div class="mat-elevation-z8">
        <table cdkDropList [cdkDropListSortingDisabled]="true"
          [cdkDropListConnectedTo]="['_newCategory'].concat(categories)" mat-table [dataSource]="dataSource" matSort>

          <!-- Title Column -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef> 标题 </th>
            <td mat-cell *matCellDef="let row"> <a [href]="'http://127.0.0.1:16224/view/'+row.id">{{row.title}}</a></td>
          </ng-container>

          <!-- Category Column -->
          <ng-container matColumnDef="category">
            <th mat-header-cell *matHeaderCellDef> 类别 </th>
            <td mat-cell *matCellDef="let row">{{row.category}}</td>
          </ng-container>

          <!-- Id Column -->
          <ng-container matColumnDef="id">
            <th mat-header-cell *matHeaderCellDef> 短链接
            </th>
            <td mat-cell *matCellDef="let row"> {{row.id}}
              <button mat-icon-button [cdkCopyToClipboard]="'http://127.0.0.1:16224/view/'+row.id">
                <mat-icon class="copy-button">content_copy</mat-icon>
              </button>
            </td>
          </ng-container>

          <!-- SaveTime Column -->
          <ng-container matColumnDef="saveTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 保存时间
            </th>
            <td mat-cell *matCellDef="let row"> {{row.saveTime?.format('YYYY/MM/DD hh:mm')}}
            </td>
          </ng-container>

          <!-- SourceUrl Column -->
          <ng-container matColumnDef="sourceUrl">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 原链接 </th>
            <td mat-cell *matCellDef="let row"><a href="#"> {{row.sourceUrl}}</a> </td>
          </ng-container>

          <!-- Rating Column -->
          <ng-container matColumnDef="rating">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 评级 </th>
            <td mat-cell *matCellDef="let row">
              <app-rating [rating]="row.rating" (change)="onChangeRating($event,row);"></app-rating>

            </td>
          </ng-container>

          <!-- RemindReadingTime Column -->
          <ng-container matColumnDef="remindReadingTime">
            <th mat-header-cell *matHeaderCellDef mat-sort-header> 提醒阅读 </th>
            <td mat-cell *matCellDef="let row">{{effectiveRemindTime(row.remindReadingTime)?.fromNow()}}</td>
          </ng-container>

          <ng-container matColumnDef="menu">
            <th mat-header-cell *matHeaderCellDef> 选项 </th>
            <td mat-cell *matCellDef="let row">
              <button mat-icon-button [matMenuTriggerFor]="menu">
                <mat-icon>more_vert</mat-icon>
              </button>
              <mat-menu #menu="matMenu">
                <button mat-menu-item (click)="openInBrowser(row)">
                  <mat-icon>open_in_browser</mat-icon>
                  <span>浏览器打开</span>
                </button>
                <button mat-menu-item (click)="openEditDialog(row);">
                  <mat-icon>edit
                  </mat-icon>
                  <span>编辑</span>
                </button>
                <button mat-menu-item (click)="confirmDeletion(row);">
                  <mat-icon>delete</mat-icon>
                  <span>删除</span>
                </button>
                <button mat-menu-item (click)="openExportDialog(row);">
                  <mat-icon>upload</mat-icon>
                  <span>导出</span>
                </button>
                <button mat-menu-item>
                  <mat-icon>print</mat-icon>
                  <span>打印</span>
                </button>

                <button mat-menu-item (click)="openPageInfoDialog(row);">
                  <mat-icon>info</mat-icon>
                  <span>详情</span>
                </button>

                <mat-divider></mat-divider>

                <div mat-menu-item style="padding: 8px 16px 0 16px;" (click)="preventMenuClosing($event);">计划阅读:
                  <mat-form-field>
                    <input matInput [ngxMatDatetimePicker]="picker" [formControl]="dateControl" [min]="minDate"
                      [max]="maxDate" [disabled]="disabled">
                    <mat-datepicker-toggle matSuffix [for]="$any(picker)">
                    </mat-datepicker-toggle>
                    <ngx-mat-datetime-picker #picker [showSpinners]="showSpinners" [showSeconds]="showSeconds"
                      [stepHour]="stepHour" [stepMinute]="stepMinute" [stepSecond]="stepSecond" [touchUi]="touchUi"
                      [color]="color">
                    </ngx-mat-datetime-picker>
                  </mat-form-field>
                </div>

              </mat-menu>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr cdkDrag (cdkDragStarted)="dragStarted();" (cdkDragEnded)="dragEnded();" [cdkDragData]="row"
            dropToSetCategory mat-row *matRowDef="let row; columns: displayedColumns;">
            <div *cdkDragPlaceholder></div>
          </tr>

          <!-- Row shown when there is no matching data. -->
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell" colspan="4">No data matching the filter "{{input.value}}"</td>
          </tr>
        </table>

        <mat-paginator [pageSizeOptions]="[10, 25, 50]"></mat-paginator>
      </div>
    </div>
  </div>
</div>